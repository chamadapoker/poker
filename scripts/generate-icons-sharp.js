// Script para gerar √≠cones PWA usando Sharp
// Execute com: node scripts/generate-icons-sharp.js

const sharp = require('sharp')
const fs = require('fs')
const path = require('path')

// Tamanhos de √≠cones necess√°rios para PWA
const iconSizes = [
  { size: 72, name: 'icon-72x72.png' },
  { size: 96, name: 'icon-96x96.png' },
  { size: 128, name: 'icon-128x128.png' },
  { size: 144, name: 'icon-144x144.png' },
  { size: 152, name: 'icon-152x152.png' },
  { size: 192, name: 'icon-192x192.png' },
  { size: 384, name: 'icon-384x384.png' },
  { size: 512, name: 'icon-512x512.png' }
]

async function generatePWAIcons() {
  const iconsDir = path.join(__dirname, '..', 'public', 'icons')
  const logoPath = path.join(__dirname, '..', 'public', 'logo.png')
  
  console.log('üé® Gerando √≠cones PWA com Sharp...')
  console.log('üìÅ Logo:', logoPath)
  console.log('üìÅ Diret√≥rio de √≠cones:', iconsDir)
  
  // Verificar se o logo existe
  if (!fs.existsSync(logoPath)) {
    console.error('‚ùå Logo n√£o encontrado em:', logoPath)
    console.log('üìù Certifique-se de que a imagem est√° em public/logo.png')
    return
  }
  
  // Criar diret√≥rio se n√£o existir
  if (!fs.existsSync(iconsDir)) {
    fs.mkdirSync(iconsDir, { recursive: true })
    console.log('üìÅ Diret√≥rio de √≠cones criado')
  }
  
  console.log('‚úÖ Logo encontrado!')
  console.log('üîÑ Gerando √≠cones...')
  
  try {
    // Gerar cada tamanho de √≠cone
    for (const { size, name } of iconSizes) {
      const outputPath = path.join(iconsDir, name)
      
      await sharp(logoPath)
        .resize(size, size, {
          fit: 'contain',
          background: { r: 0, g: 0, b: 0, alpha: 0 } // Fundo transparente
        })
        .png({
          quality: 100,
          compressionLevel: 9
        })
        .toFile(outputPath)
      
      console.log(`‚úÖ Criado: ${name} (${size}x${size}px)`)
    }
    
    // Gerar favicon.ico
    const faviconPath = path.join(__dirname, '..', 'public', 'favicon.ico')
    await sharp(logoPath)
      .resize(32, 32, {
        fit: 'contain',
        background: { r: 0, g: 0, b: 0, alpha: 0 }
      })
      .png()
      .toFile(faviconPath.replace('.ico', '.png'))
    
    console.log('‚úÖ Criado: favicon.png (32x32px)')
    
    // Gerar apple-touch-icon
    const appleTouchIconPath = path.join(__dirname, '..', 'public', 'apple-touch-icon.png')
    await sharp(logoPath)
      .resize(180, 180, {
        fit: 'contain',
        background: { r: 0, g: 0, b: 0, alpha: 0 }
      })
      .png()
      .toFile(appleTouchIconPath)
    
    console.log('‚úÖ Criado: apple-touch-icon.png (180x180px)')
    
    console.log('')
    console.log('üéâ Todos os √≠cones PWA foram gerados com sucesso!')
    console.log('üì± O PWA agora est√° pronto para instala√ß√£o')
    console.log('')
    console.log('üìã √çcones criados:')
    iconSizes.forEach(({ size, name }) => {
      console.log(`   - ${name} (${size}x${size}px)`)
    })
    console.log('   - favicon.png (32x32px)')
    console.log('   - apple-touch-icon.png (180x180px)')
    
  } catch (error) {
    console.error('‚ùå Erro ao gerar √≠cones:', error.message)
    console.log('')
    console.log('üîß SOLU√á√ÉO ALTERNATIVA:')
    console.log('1. Use uma ferramenta online: https://realfavicongenerator.net/')
    console.log('2. Fa√ßa upload da imagem public/logo.png')
    console.log('3. Baixe os √≠cones gerados')
    console.log('4. Coloque na pasta public/icons/')
  }
}

// Executar se chamado diretamente
if (require.main === module) {
  generatePWAIcons()
}

module.exports = { generatePWAIcons, iconSizes }
